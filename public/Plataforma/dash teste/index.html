<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma | GuardTech+</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="imagens/sergio.usa.na.aba.ico">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>
    <script src="../Monitoramento1/alerta.js"></script>
</head>

<body onload="atualizacaoPeriodicaMedia()">
    <div class="screen">
        <div class="header">
            <p onclick="voltarHome()">Voltar</p>
            <h2>GUARDTECH+</h2>
            <img class="logo" src="imagens/guardsemescrita.png">
        </div>
        <div class="box-nav-bar">
            <div class="nav-bar-L">
                <ul>
                    <li><a href="../Perfil/index.html">Perfil</a></li>
                    <li><a href="../CONTATO/contato.html">Dúvidas frequentes</a></li>
                </ul>
            </div>
            <div class="nav-bar-R">
                <ul>
                    <li><a href=""><span>Monitoramento</span></a></li>
                    <li><a href="../HISTORICO/index.html">Histórico</a></li>
                </ul>
            </div>
        </div>
        <!-- Insere a tela -->

        <div class="dash-boxes">
            <div class="info-box">
                <h1>Informações<br>Armazém</h1>
                <img src="imagens/fazenda.png" id="imagemfazenda">
                <div class="info_text">
                    <p><b>Nome:</b> Armazém XPTO</p>
                    <p><b>Endereço:</b> Rua Haddock Lobo, Nº 535</p>
                    <p><b>Tipo:</b> Silo</p>
                    <p><b>Prazo:</b> Curto</p>
                </div>
            </div>
           <div class="left-box">
                <div class="extra-boxes">
                    <div class="clima-box">
                        <h1>Clima</h1>
                        <div class="clima_elements">
                            <img src="imagens/sol.png">
                            <h1>26°C<br>Ensolarado</h1>
                            <div class="max_min">
                                <div class="max">
                                    <img src="imagens/seta-esquerda.png" alt="">
                                    <p>30ºC</p>
                                </div>
                                <div class="min">
                                    <img src="imagens/seta-para-cima (1).png" alt="">
                                    <p>20ºC</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="horario-box">
                        <h1>Relógio (GMT-3)</h1>
                        <div class="elementos_relogio">
                            <div class="relogio">
                                <h1 id="relogio"></h1>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="parametros-box">
                    <h1>Parâmetros</h1>
                    <p>Ideais</p>
                    <div class="temp-umi-box">
                        <div class="parametro-temp">
                            <div class="parametro-back">
                                <h2>14°</h2>
                            </div>
                            <p>Temperatura</p>
                        </div>
                        <div class="parametro-umi">
                            <div class="parametro-back">
                                <h2>18%</h2>
                            </div>
                            <p>Umidade</p>
                        </div>
                        
                    </div>
                </div>
            </div>
            <div class="atual-box">
                <h1>Atual</h1>
                <div class="alert-box">
                    <div class="temp-box">
                        <p>Temperatura</p>
                        <h1 id="temp_atual">00ºC</h1>
                        <div class="alerta-temperatura" id="indicador_temp">

                        </div>

                    </div>
                    <div class="umi-box">
                        <p>Umidade</p>
                        <h1 id="umidade_atual">00%</h1>
                        <div class="alerta-umidade" id="indicador_umidade">

                        </div>
                    </div>
                </div>
            </div>

            <div class="media-box">
                <h1>Média<br>(Última hora)</h1>
                <div class="media-all">
                    <p>Temperatura</p>
                    <div class="media-temp" id="cor_temp">
                        <h1 id="mediaTemp">00</h1>
                    </div>
                    <p>Umidade</p>
                    <div class="media-umi" id="cor_umi">
                        <h1 id="mediaUmi">00</h1>
                    </div>
                </div>
            </div>
        </div>
        

        <div class="chart-boxes">
            <div class="chart-temp">
                <canvas id="chart_temperatra"></canvas>
            </div>
            <div class="chart-umi">
                <canvas id="chart_umidade"></canvas>
            </div>
        </div>
    </div>
</body>

</html>

<script>
    //Relogio 
    const horas = document.getElementById('relogio');
    const minutos = document.getElementById('minutos');
    const segundos = document.getElementById('segundos');
    let horaCompleta = ""

    const relogio = setInterval(function time() {
        let DataDeHoje = new Date();
        let hr = DataDeHoje.getHours();
        let min = DataDeHoje.getMinutes();
        let sec = DataDeHoje.getSeconds();


        if (min <= 9) {
            min = `0${min}`
        }
        if (sec <= 9) {
            sec = `0${sec}`
        }
        horaCompleta = `${hr}:${min}:${sec}`
        horas.innerHTML = horaCompleta;
    })

    // GRAFICO TEMPERATURA

    // Inicializa um array vazio para os dados de temperatura
    var DadoTemperatura = [];

    var chart_temp = document.getElementById('chart_temperatra').getContext('2d');
    chart_temp.canvas.width = 480;
    chart_temp.canvas.height = 170;
    var grafico_temperatura = new Chart(chart_temp, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Temperatura (°C)',
                data: [],
                backgroundColor: 'rgba(3, 155, 207, 0.3)',
                borderColor: 'rgba(3, 155, 207, 1)',
                borderWidth: 5
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });



    var mediatemp = 0;

    // Função para adicionar um novo dado de temperatura
    function AdicionarDadoDeTemperatura(temperatura, momento) {
        // Gera um novo dado de temperatura aleatório entre 0 e 30 graus Celsius
        var novaTemperatura = temperatura;
        console.log(momento)

        // Adiciona o novo dado ao array de dados de temperatura
        // DadoTemperatura.push(novaTemperatura);
        // Adiciona a hora atual ao array de labels 
        grafico_temperatura.data.labels.push(momento); 

        // Adiciona o novo dado ao conjunto de dados do gráfico
        grafico_temperatura.data.datasets[0].data.push(novaTemperatura);
        // Atualiza o gráfico
        grafico_temperatura.update();


        let alerta_temperatura = document.getElementById('indicador_temp')
        let temperatura_atual = document.getElementById('temp_atual')
        let alerta_media = document.getElementById('cor_temp')

        temperatura_atual.innerHTML = `${novaTemperatura}ºC`

        if (novaTemperatura <= 14) {
            alerta_temperatura.style.backgroundColor = '#c4ee8e'
        } else if (novaTemperatura <= 18) {
            alerta_temperatura.style.backgroundColor = '#eccf4d'
        } else {
            alerta_temperatura.style.backgroundColor = '#e66666'
        }


        let media_temperatura = document.getElementById('mediaTemp')

        mediatemp += novaTemperatura

        if (grafico_temperatura.data.datasets[0].data.length >= 7) {
            let media = (mediatemp / 7).toFixed(2)
            media_temperatura.innerHTML = `${media}ºC`

            if (media <= 14) {
                alerta_media.style.backgroundColor = '#c4ee8e'
            } else if (media <= 18) {
                alerta_media.style.backgroundColor = '#eccf4d'
            } else {
                alerta_media.style.backgroundColor = '#e66666'
            }

            //zerando dados
            mediatemp = 0 
            grafico_temperatura.data.datasets[0].data = []
            grafico_temperatura.data.labels = []
            grafico_temperatura.update();
        }
    }

    // // Chama a função para adicionar dados de temperatura a cada 10 segundos
    // setInterval(AdicionarDadoDeTemperatura, 10000); // Adiciona um dado a cada 10 segundos




    // // GRAFICO UMIDADE

    // // Inicializa um array vazio para os dados de temperatura


    // var DadoUmidade = [];


    var chart_umi = document.getElementById('chart_umidade').getContext('2d');
    chart_umi.canvas.width = 480;
    chart_umi.canvas.height = 170;
    var grafico_umidade = new Chart(chart_umi, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Umidade (%)',
                data: [],
                backgroundColor: 'rgba(3, 155, 207, 0.3)',
                borderColor: 'rgba(3, 155, 207)',
                borderWidth: 5
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    let DadoUmidade = []

    function AdicionarDadoDeUmidade(umidade, momento) {
        console.log(momento)
        // Gera um novo dado de umidade aleatorio entre 0 e 100
        var novaUmidade = umidade;
        // Adiciona o novo dado ao array de dados de temperatura
        DadoUmidade.push(novaUmidade);
        // Adiciona a contagem atual ao array de labels
        grafico_umidade.data.labels.push(momento); 

        // Adiciona o novo dado ao conjunto de dados do gráfico
        grafico_umidade.data.datasets[0].data.push(novaUmidade);

        // Atualiza o gráfico
        grafico_umidade.update();


        let alerta_umidade = document.getElementById('indicador_umidade')
        let umi_atual = document.getElementById('umidade_atual')
        umi_atual.innerHTML = `${novaUmidade}%`

        if (novaUmidade <= 18) {
            alerta_umidade.style.backgroundColor = '#c4ee8e'
        } else if (novaUmidade <= 25) {
            alerta_umidade.style.backgroundColor = '#eccf4d'
        } else {
            alerta_umidade.style.backgroundColor = '#e66666'
        }

        let media_umidade = document.getElementById('mediaUmi')
        let cor_umidade = document.getElementById('cor_umi')
        medumidade += novaUmidade

        if (grafico_umidade.data.datasets[0].data.length >= 7) {
            let media = (medumidade / 6).toFixed(2)
            media_umidade.innerHTML = `${media}%`

            if(media <= 18) {
                cor_umidade.style.backgroundColor = '#c4ee8e'
            } else if (media <= 25) {
                cor_umidade.style.backgroundColor = '#eccf4d'
            } else {
                cor_umidade.style.backgroundColor = '#e66666'
            }

            medumidade = 0 
            grafico_umidade.data.datasets[0].data = []
            grafico_umidade.data.labels = []
            grafico_umidade.update();

            

        }
        
    }

    // // Função para adicionar um novo dado de temperatura
    // let medumidade = 0

    // function AdicionarDadoDeUmidade() {
    //     // Gera um novo dado de umidade aleatorio entre 0 e 100
    //     var novaUmidade = Number((Math.random() * 40).toFixed(2));
    //     // Adiciona o novo dado ao array de dados de temperatura
    //     DadoUmidade.push(novaUmidade);
    //     // Adiciona a contagem atual ao array de labels
    //     grafico_umidade.data.labels.push(horaCompleta);

    //     // Adiciona o novo dado ao conjunto de dados do gráfico
    //     grafico_umidade.data.datasets[0].data.push(novaUmidade);

    //     // Atualiza o gráfico
    //     grafico_umidade.update();


    //     let alerta_umidade = document.getElementById('indicador_umidade')
    //     let umi_atual = document.getElementById('umidade_atual')
    //     umi_atual.innerHTML = `${novaUmidade}%`

    //     if (novaUmidade <= 18) {
    //         alerta_umidade.style.backgroundColor = '#c4ee8e'
    //     } else if (novaUmidade <= 25) {
    //         alerta_umidade.style.backgroundColor = '#eccf4d'
    //     } else {
    //         alerta_umidade.style.backgroundColor = '#e66666'
    //     }

    //     let media_umidade = document.getElementById('mediaUmi')
    //     let cor_umidade = document.getElementById('cor_umi')
    //     medumidade += novaUmidade

    //     if (grafico_umidade.data.datasets[0].data.length >= 7) {
    //         let media = (medumidade / 6).toFixed(2)
    //         media_umidade.innerHTML = `${media}%`

    //         if(media <= 18) {
    //             cor_umidade.style.backgroundColor = '#c4ee8e'
    //         } else if (media <= 25) {
    //             cor_umidade.style.backgroundColor = '#eccf4d'
    //         } else {
    //             cor_umidade.style.backgroundColor = '#e66666'
    //         }

    //         medumidade = 0 
    //         grafico_umidade.data.datasets[0].data = []
    //         grafico_umidade.data.labels = []
    //         grafico_umidade.update();

            

    //     }
        
    // }
   
    function voltarHome(){
  window.location.href = '../SITE/index.html';}
    // Chama a função para adicionar dados de temperatura a cada 2 segundos
    // setInterval(AdicionarDadoDeUmidade, 10000); // Adiciona um dado a cada 10 segundos



</script>